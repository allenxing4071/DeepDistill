# DeepDistill 内容处理 Skill

> **核心原则：内容处理是管线的基石。ASR/OCR/文档提取的质量直接决定下游 AI 分析的上限。**

## 触发词
用户说"转录"、"ASR"、"OCR"、"文档提取"、"内容处理"、"whisper"、"音频"、"图片文字"时执行本 Skill。

## 必须遵守的 Rules
- **R0（变更控制）**：内容处理属于核心链路，修改前必须征得用户同意
- **R3（模型管理）**：模型文件不入 Git，按需下载，标注 MPS 兼容性
- **R8（经验沉淀）**：ASR/OCR 相关经验追加到本文件

---

## 一、ASR 语音转文字（视频/音频）

### 技术方案
- **音轨提取**：ffmpeg（必须预装）
- **语音识别**：faster-whisper（CTranslate2 加速的 Whisper）
- **设备优先级**：MPS (Mac) > CUDA > CPU

### 模型选择指南

| 模型 | 大小 | 速度 | 精度 | 适用场景 |
|---|---|---|---|---|
| tiny | 39M | 极快 | 一般 | 快速预览/测试 |
| base | 74M | 快 | 较好 | 短视频/播客 |
| small | 244M | 中 | 好 | 日常使用推荐 |
| medium | 769M | 慢 | 很好 | 高精度需求 |
| large-v3 | 1.5G | 很慢 | 最好 | 专业级/多语言 |

### 处理流程
```
输入文件（mp4/mov/mp3/wav/...）
  │
  ├── ffmpeg 提取音轨 → WAV 16kHz mono
  │
  ├── faster-whisper 转录
  │   ├── 语言检测（自动 / 指定）
  │   ├── 分段转录（带时间戳）
  │   └── 输出：segments + 完整文本
  │
  └── 后处理
      ├── 去除重复/口头禅
      ├── 标点修正
      └── 段落合并
```

### 注意事项
- 长视频（>30 分钟）建议分段处理，避免 OOM
- MPS 加速需要 PyTorch 2.0+
- 中文识别建议使用 medium 及以上模型

---

## 二、OCR 图片文字提取

### 技术方案
- **首选**：EasyOCR（开箱即用，中英文支持好）
- **备选**：PaddleOCR（精度更高，但安装复杂）

### 处理流程
```
输入图片（JPG/PNG/...）
  │
  ├── 图片预处理（缩放/去噪/二值化）
  │
  ├── OCR 识别
  │   ├── 文字区域检测
  │   ├── 文字识别
  │   └── 输出：文字 + 位置坐标 + 置信度
  │
  └── 后处理
      ├── 按阅读顺序排列
      ├── 过滤低置信度结果
      └── 合并为连贯文本
```

---

## 三、文档/网页提取

### 支持格式与工具

| 格式 | 工具 | 提取内容 |
|---|---|---|
| PDF | PyPDF2 / pdfplumber | 文字 + 表格 + 元数据 |
| Word (.docx) | python-docx | 文字 + 标题层级 + 表格 |
| PPT (.pptx) | python-pptx | 幻灯片文字 + 备注 |
| Excel (.xlsx) | openpyxl | 表格数据 |
| HTML/网页 | BeautifulSoup / trafilatura | 正文提取（去广告/导航） |

### 处理原则
- 保留文档结构（标题层级、列表、表格）
- 提取元数据（作者、创建时间、页数）
- 表格转为结构化数据（不是纯文本拼接）

---

## 四、质量检查清单

每次内容处理后，检查以下项目：

- [ ] 输出文本非空
- [ ] 中文/英文识别正确（无乱码）
- [ ] 保留了合理的段落结构
- [ ] 时间戳对齐正确（ASR）
- [ ] 表格数据完整（文档提取）
- [ ] 置信度过低的结果已标注或过滤（OCR）

---

## 经验沉淀

<!-- ASR/OCR/文档提取相关经验追加到此处 -->
